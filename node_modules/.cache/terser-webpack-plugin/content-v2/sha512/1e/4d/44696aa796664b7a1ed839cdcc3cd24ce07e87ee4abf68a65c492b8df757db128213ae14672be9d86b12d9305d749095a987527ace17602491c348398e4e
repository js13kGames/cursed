{"code":"!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,\"a\",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p=\"\",s(s.s=8)}([function(t,e,s){t.exports=s.p+\"3a0878f3c90f3669fd9547447918a18e.png\"},function(t,e,s){t.exports=s.p+\"5a927a5642c1cd704899e1c64336378b.png\"},function(t,e,s){t.exports=s.p+\"716436ab0e20e856d128ec96d952b7e6.png\"},function(t,e,s){t.exports=s.p+\"c0035619fcaeaa7578b6f7cc2b69ae94.png\"},function(t,e,s){t.exports=s.p+\"1928d6b60b677fb1eeb75ff8339f1c41.png\"},function(t,e,s){t.exports=s.p+\"3015c47eeeebffc8cf41182db9eae0ad.png\"},function(t,e,s){t.exports=s.p+\"396ddd4db8873c9ad631d7a8fc540b3d.png\"},function(t,e,s){},function(t,e,s){\"use strict\";s.r(e);let i=window;i.DEBUG=!1,i.entities=[],i.tick=0,i.restart=t=>{},i.getCenter=t=>{},i.sq=t=>Math.pow(t,2),i.sqDist=(t,e)=>i.sq(t.x-e.x)+i.sq(t.y-e.y),i.hyp=(t,e)=>Math.sqrt(t*t+e*e),i.ran=(t=1)=>Math.random()*t,i.ranNorm=(t=1)=>(Math.random()-.5)*t,i.ranInt=t=>Math.round(Math.random()*t),i.oneIn=t=>Math.round(Math.random()*t)===t,i.ranSeq=t=>{let e=Math.sin(1e5*t);return e-Math.floor(e)},i.next=(t,e)=>{let s=t.indexOf(e);if(-1!==s)return s+1<t.length?t[s+1]:t[0]};var h=i;h.keyMap=0,h.keys={87:1,65:2,83:4,68:8,32:16},document.onkeydown=function(t){var e=t.keyCode||t.key;keys[e]&&(keyMap|=keys[e],t.preventDefault())},document.onkeyup=function(t){var e=t.keyCode||t.key;keyMap&keys[e]&&(keyMap^=keys[e],t.preventDefault())};var a=1,n=2,r=3,o=[{enemies:{floater:1,sniper:0,chaser:0}},{enemies:{floater:2,sniper:0,chaser:0}}],l=s(0),_=s.n(l),c=s(1),d=s.n(c),p=s(2),u=s.n(p),y=s(3),b=s.n(y),g=s(4),m=s.n(g),k=s(5),f=s.n(k),x=s(6),v=s.n(x),T=[u.a,d.a,v.a,m.a,b.a,f.a,_.a];var w=new class{constructor(t={}){this._texts=[],this._numTexts=100,this._backrgb={r:251,g:255,b:241},this._finalrgb={r:251,g:255,b:241},this._main=document.getElementById(\"main-block\"),this._dialog=document.getElementById(\"base-dialog\"),this._url=document.getElementById(\"url\"),this._mainText=document.getElementById(\"main-text\"),this._score=document.getElementById(\"score\"),this._finalScoreBs=document.getElementsByClassName(\"final-score\"),this._deathDialog=document.getElementById(\"death-dialog\"),this._upgradeDialog=document.getElementById(\"upgrade-dialog\"),this._winDialog=document.getElementById(\"win-dialog\"),this._choice1=document.getElementById(\"choice1\"),this._upgrade1=document.getElementById(\"upgrade-1\"),this._choice2=document.getElementById(\"choice2\"),this._upgrade2=document.getElementById(\"upgrade-2\"),this._typeOuts=[];for(let t=0;t<this._numTexts;t++){let t=document.createElement(\"div\");t.classList.add(\"back-text\",\"abs\"),t.style=`top: ${h.ranInt(100)}vh; left:${h.ranInt(100)}vw;`,t.textContent=\"/\",this._texts.push(t),document.body.appendChild(t)}setInterval(t=>{let e=this._texts[h.ranInt(this._numTexts)-1];e&&(e.textContent=String.fromCharCode(h.ranInt(42)+48).toLowerCase())},10)}setState(t){this._prevState=this._state,this._state=t,this._stateLoop()}darken(){this._backrgb={r:this._backrgb.r-1,g:this._backrgb.g-1,b:this._backrgb.b-1},this._main.style.backgroundColor=`rgb(${this._backrgb.r} ${this._backrgb.g} ${this._backrgb.b})`}typeOut(t,e){this._typeOuts[t.id]?this._typeOuts[t.id].map(t=>clearTimeout(t)):this._typeOuts[t.id]=[],t.textContent=\"\";for(let s=0;s<e.length;s++)this._typeOuts[t.id].push(setTimeout(i=>t.textContent+=e[s],65*s))}_stateLoop(){switch(this._state){case\"INTRODUCTION\":break;case\"WAIT_CHOOSE_BACK\":this._prevState!==this._state&&this.typeOut(this._mainText,\"^^^^ Level complete: travel back\");break;case\"WAIT_CHOOSE_UPGRADE\":this._mainText.textContent=\"\";break;case\"START_LEVEL\":this.clearDialogs(),setTimeout(t=>{this.typeOut(this._url,\"____cursed____/?level=\"+(h._levels.length-h._level))},333);break;case\"START_WIN\":this.clearDialogs(),this._winDialog.classList.add(\"visible\",\"flex-center\");break;case\"PLAYING\":this._prevState!==this._state&&this.typeOut(this._mainText,\"W, A, S, D, SPACE to shoot\");break;case\"DEAD\":this._prevState!==this._state&&(this.typeOut(this._mainText,\"~~ sorry, you died :/ ~~\"),this._deathDialog.classList.add(\"visible\",\"flex-center\"))}}setScore(t){this._score.textContent=t}setFinalScore(t){for(let e=0;e<this._finalScoreBs.length;e++)this._finalScoreBs[e].textContent=t}showUpgrades(t={}){let{level:e,click1:s,click2:i}=t;this._upgradeDialog.classList.add(\"visible\"),this._choice1.src=T[2*e-1],this._choice2.src=T[2*e],this._upgrade1.onclick=s,this._upgrade2.onclick=i}clearDialogs(){let t=document.getElementsByClassName(\"dialog\");for(let e=0;e<t.length;e++){t[e].classList.contains(\"visible\")&&t[e].classList.remove(\"visible\")}}createDialog(t={}){let{main:e=\"Contratulations!\",sub:s=\"You have died\",button:i=!1,classes:a=[],ran:n=!1,typeout:r=!1,pos:o=[]}=t,l=this._dialog.cloneNode(!0),_=h.ranInt(100);return l.id=l.id+\"-\"+_,l.childNodes[5].id=\"main-\"+_,l.childNodes[5].textContent=e,l.childNodes[7].textContent=s,l.classList.add(...a,\"active\"),setTimeout(t=>{l.classList.add(\"visible\")},1),n&&(l.style=`top: ${20+h.ranInt(60)}vh; left:${20+h.ranInt(60)}vw; `),o&&(l.style=`top: ${o[1]}px; left:${o[0]}px; `),this._main.append(l),_}setUrl(t){this.typeOut(this._url,t)}};var I=new class{constructor(){this.canvas=document.getElementById(\"_canvas\"),this.cursor={x:0,y:0},this._scale(),this._listen()}_scale(){var t=window.devicePixelRatio||1;this._bounds=this.canvas.getBoundingClientRect(),this.canvas.width=this._bounds.width*t,this.canvas.height=this._bounds.height*t,this.ctx=this.canvas.getContext(\"2d\"),this.ctx.scale(t,t),this.ctx.imageSmoothingEnabled=!1,h.bounds={top:0,left:0,width:this._bounds.width,height:this._bounds.height},h.bounds.getCenter=t=>({x:h.bounds.width/2,y:h.bounds.height/2})}_resize(){this._bounds=this.canvas.getBoundingClientRect(),this.canvas.width=this._bounds.width*dpr,this.canvas.height=this._bounds.height*dpr,h.bounds={top:0,left:0,width:this.canvas.width,height:this.canvas.height}}_listen(){document.addEventListener(\"mousemove\",t=>{this.cursor={x:t.clientX-this._bounds.left,y:t.clientY-this._bounds.top}}),this.cursor={x:this.canvas.width/2,y:this.canvas.height/2}}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawDeathScreen(){}drawBackground(){this.ctx.fillStyle=\"#DDD\",this.ctx.fillRect(0,0,100,50),this.ctx.fillRect(this._bounds.width-50,0,this._bounds.width,50),this.ctx.fillRect(100,0,this._bounds.width-150,15),this.ctx.fillRect(100,35,this._bounds.width-150,15),this.ctx.fillStyle=\"#EEE\"}drawBackButton(t=.2,e=1){this.ctx.globalAlpha=t,this.ctx.fillStyle=\"#FFF\",this.ctx.fillRect(20,15,40,20),this.ctx.strokeStyle=e?`hsl(${e%255}, 100%, 40%)`:\"#888\",this.ctx.strokeRect(20,15,40,20),this.ctx.strokeStyle=\"#888\",this.ctx.beginPath(),this.ctx.moveTo(40,20),this.ctx.lineTo(35,25),this.ctx.lineTo(40,30),this.ctx.stroke(),this.ctx.globalAlpha=1}drawReticule(){}drawFlash(){}drawLoader(){this.ctx.fillStyle=\"#222\",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}_getBounds(){this._bounds=this.canvas.getBoundingClientRect()}},S={introduction:[{action:t=>{h.player.moveTo(h.bounds.getCenter()),h.player.isDisabled=!0,h.entities.push(h.player)},onTick:t=>{h.player.nextType()},tickInterval:15,starttick:0,endtick:1200},{action:t=>{let e=w.createDialog({main:\"\",sub:\"\",classes:[\"top-center\",\"small\",\"wide\",\"t-left\"],pos:[400,10]});w.typeOut(document.getElementById(\"main-\"+e),\"You were a shapeshifter.\")},tickInterval:43,starttick:1,endtick:200},{action:t=>{let e=w.createDialog({main:\"\",sub:\"\",classes:[\"small\",\"wide\",\"t-left\"],pos:[460,50]});w.typeOut(document.getElementById(\"main-\"+e),\"You were CURSED, forced to occupy a single form.\")},tickInterval:43,starttick:200,endtick:500},{action:t=>{let e=w.createDialog({main:\"\",sub:\"\",classes:[\"small\",\"wide\",\"t-left\"],pos:[50,350]});w.typeOut(document.getElementById(\"main-\"+e),\"You were cast forward into the depths of the brower.\")},tickInterval:43,starttick:500,endtick:800},{action:t=>{let e=w.createDialog({main:\"\",sub:\"\",classes:[\"small\",\"wide\",\"t-left\"],pos:[10,280]});w.typeOut(document.getElementById(\"main-\"+e),\"Fight your way back . . . . .\")},tickInterval:43,starttick:800,endtick:1100}],dead:[{action:t=>{},onTick:t=>{w.createDialog({ran:!0})},tickInterval:250,starttick:0,endtick:1e3}]};function D(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}var E=class{constructor(t={}){this._parent=t.parent||\"game\",this._type=t.type||\"entity\",this._speed=t.speed||1,this._health=t.health||1,this._damage=t.damage||1,this._pos=t.pos?{...t.pos}:{x:h.bounds.width/2,y:h.bounds.height/2,angle:0},this._vel=t.vel?{...t.vel}:{x:0,y:0},this._constAngle=t.constAngle,this._collides=t.collides||!0,this._buildIn=t.buildIn||!1,this._buildSpeed=t.buildSpeed||1,this._hitrad=this._buildIn?1:t.hitrad||5,this._maxrad=t.maxrad||this._hitrad,this.isDead=!1}takeDamage(t){this._health-=t}moveTo(t){this._pos.x=t.x,this._pos.y=t.y}_checkCollisions(){let t=h.entities.filter(t=>h.sqDist(this._pos,t._pos)<h.sq(.6*this._hitrad)+h.sq(.6*t._hitrad)&&t._collides);this._handleCollisions(t)}_handleCollisions(t){}collides(t,e){return h.sqDist(this._pos,t)<h.sq(.6*this._hitrad)+h.sq(.6*e)}_checkBounds(){return this._pos.x-this._hitrad<2?1:this._pos.x+this._hitrad>h.bounds.width?1:this._pos.y-this._hitrad<2?2:this._pos.y+this._hitrad>h.bounds.height?2:void 0}_die(){this.isDead=!0}_build(){this._hitrad<this._maxrad&&(this._hitrad+=this._buildSpeed)}_bounce(){switch(this._checkBounds()){case 1:this._vel.x*=-1;break;case 2:this._vel.y*=-1}}_updatePos(){this._pos.x+=this._vel.x*this._speed,this._pos.y-=this._vel.y*this._speed,this._pos.angle=this._constAngle||D(this._pos,this._target)}_updateVel(){this._vel.x*=this._vel.x>.1||this._vel.x<.1?.95:0,this._vel.y*=this._vel.y>.1||this._vel.y<.1?.95:0}update(t){this._buildIn&&this._build(),this.health<=0&&this._die(),this.collides&&this._checkCollisions(),this._updatePos(),this._updateVel(),this._checkBounds(),this._render(t)}_draw(t){t.fillRect(this._pos.x,this._pos.y,20*this._hitrad/this._maxrad,20*this._hitrad/this._maxrad)}_drawHitbox(t){t.beginPath(),t.arc(0,0,.6*this._hitrad,0,2*Math.PI),t.stroke(),t.closePath()}_render(t){t.save(),t.translate(this._pos.x,this._pos.y),t.rotate(this._pos.angle),this._draw(t),t.restore()}},C=class extends E{constructor(t){super(t),this._maxrad=t.maxrad||30,this._collides=!1,this._type=\"explosion\",this._fill=t.fill}update(t){this._build(),this._hitrad>=this._maxrad?this._die():this._render(t)}_draw(t){t.beginPath(),t.strokeStyle=`rgba(0, 100, 0, ${.6-this._hitrad/this._maxrad})`,t.arc(0,0,this._hitrad,0,2*Math.PI),t.stroke(),this._fill&&(t.fillStyle=this.fill,t.fill())}},P=class extends E{constructor(t){super(t),this._speed=4,this._hitrad=8,this._collides=!0,this._type=a,this._damage=1,this._subTypes=[\"bullet\",\"ripple\",\"bomb\"],this._subType=t.subType||\"bullet\",this._initProjectileType()}static getTypes(){return[\"bullet\",\"ripple\",\"bomb\",\"mine\"]}_initProjectileType(){switch(\"function\"==typeof this._subType?this._subType():this._subType){case\"bullet\":this._draw=t=>{t.fillStyle=\"rgba(2, 100, 2, 0.1)\",t.fillRect(-this._hitrad,-this._hitrad/2,-this._hitrad/2,this._hitrad/2),t.fillStyle=\"rgba(2, 100, 2, 0.1)\",t.fillRect(-this._hitrad/2,-this._hitrad/2,-this._hitrad/2,this._hitrad/2),t.fillStyle=\"rgba(0, 20, 100, 0.8)\",t.fillRect(0,-this._hitrad/2,-this._hitrad/2,this._hitrad/2)};break;case\"ripple\":this._vel={x:0,y:0},this._hitrad=5,this._maxrad=100,this._draw=t=>{this._hitrad<this._maxrad?this._hitrad+=2:this._die(),t.beginPath(),t.arc(0,0,.6*this._hitrad,0,2*Math.PI),t.stroke(),t.closePath()};break;case\"bomb\":this._vel={x:0,y:0},this._hitrad=20,this._draw=t=>{t.beginPath(),t.fillStyle=\"#4DC5F9\",t.arc(0,0,.6*this._hitrad,0,2*Math.PI),t.fill(),t.closePath()}}}_die(){let t=new C({pos:this._pos});h.entities.push(t),this.isDead=!0}_handleCollisions(t){t.map(t=>{switch(t._type){case this._type:case this._parent:break;default:t.takeDamage(this._damage),this._die()}})}update(t){this._checkCollisions(),this._checkBounds()&&this._die(),this._pos.x+=this._vel.x*this._speed,this._pos.y-=this._vel.y*this._speed,this._pos.angle=this._constAngle,this._render(t)}},A=class extends E{constructor(t={}){switch(super(t),this._subType=t.subType||\"floater\",this._speed=.5,this._type=n,this._subType){case\"floater\":this._maxrad=30,this._hitrad=1,this._health=1;break;case\"sniper\":t.health=2}}_die(){h.entities.push(new C({pos:this._pos})),this.isDead=!0}_shoot(){if(h.tick%10==0){let t=this._pos.angle+(h.ran()-.5)/10;this._proj=new P({parent:n,pos:this._pos,vel:{x:Math.cos(t),y:-Math.sin(t)},constAngle:t}),h.entities.push(this._proj)}}_changeTarget(){this._pos.angle=D(this._pos,{x:Math.round(Math.random()*h.bounds.width),y:Math.round(Math.random()*h.bounds.height)})}update(t){switch(this._buildIn&&this._build(),0===this._health&&this._die(),this._checkCollisions(),this._subType){case\"floater\":h.oneIn(100)&&this._changeTarget(),this._vel.x+=Math.cos(this._pos.angle)/10,this._vel.y+=-Math.sin(this._pos.angle)/10,this._pos.x+=this._vel.x*this._speed,this._pos.y-=this._vel.y*this._speed}this._bounce(),this._updateVel(),this._render(t)}_draw(t){t.strokeWidth=2;let e=this._hitrad;switch(this._subType){case\"floater\":t.rotate(Math.PI/4),t.fillStyle=\"white\",t.fillRect(-e/2,-e/2,e,e),t.strokeRect(-e/2,-e/2,e,e)}}},B=class extends E{constructor(t){super(t),this.subTypes=[\"cPointer\",\"cRapid\",\"cDiagonal\",\"cCross\",\"cBomb\",\"cQuestion\",\"cFinger\"],this._type=r,this._subType=this.subTypes[0],this._projType=P.getTypes()[0],this._speed=.5,this._shots=1,this._firerate=14,this._imgLoaded=!1,this._cursorImg=new Image,this.isDisabled=!1,this._cursorImg.onload=t=>{this._imgLoaded=!0},this._initPlayerType()}_initPlayerType(){switch(this._subType){case\"cPointer\":this._cursorImg.src=T[0],this._shots=1,this._firerate=14,this._projType=P.getTypes()[0];break;case\"cRapid\":this._cursorImg.src=T[1],this._shots=1,this._firerate=6;break;case\"cDiagonal\":this._cursorImg.src=T[2],this._shots=2,this._firerate=10;break;case\"cCross\":this._cursorImg.src=T[3],this._shots=4,this._firerate=8;break;case\"cBomb\":this._cursorImg.src=T[4],this._shots=1,this._firerate=50,this._projType=P.getTypes()[2];break;case\"cQuestion\":this._cursorImg.src=T[5],this._projType=t=>P.getTypes()[h.ranInt(P.getTypes().length)];break;case\"cFinger\":this._cursorImg.src=T[6],this._shots=1,this._firerate=50,this._projType=P.getTypes()[1]}}reset(){this.isDisabled=!1,this.isDead=!1,this._pos.x=h.bounds.getCenter().x,this._pos.y=h.bounds.getCenter().y,this._vel.x=0,this._vel.y=0}nextType(){this._subType=h.next(this.subTypes,this._subType),this._initPlayerType()}setType(t){this._subType=t,this._initPlayerType()}_handleCollisions(t){t.map(t=>{t._type===n&&this._die()})}_die(){h.entities.push(new C({pos:this._pos})),this.isDead=!0}_shoot(){if(h.tick%this._firerate==0)for(let t=0;t<this._shots;t++){let e=this._pos.angle+(h.ran()-.5)/10+2*Math.PI/this._shots*t;this._proj=new P({parent:r,subType:this._projType,pos:this._pos,vel:{x:Math.cos(e),y:-Math.sin(e)},constAngle:e}),h.entities.push(this._proj)}}update(t){this._buildIn&&this._build(),this._checkCollisions(),this._updatePos(),player.isDisabled||(h.keyMap&h.keys[87]&&(this._vel.y+=this._speed),h.keyMap&h.keys[65]&&(this._vel.x-=this._speed),h.keyMap&h.keys[83]&&(this._vel.y-=this._speed),h.keyMap&h.keys[68]&&(this._vel.x+=this._speed),h.keyMap&h.keys[32]&&this._shoot()),this._updateVel(),this._bounce(),this._render(t)}_render(t){if(t.save(),t.translate(this._pos.x,this._pos.y),t.rotate(this._pos.angle+Math.PI/2),this._imgLoaded){let e=1.5*this._cursorImg.width*this._hitrad/this._maxrad,s=1.5*this._cursorImg.height*this._hitrad/this._maxrad;t.drawImage(this._cursorImg,-e/2,-s/2,e,s)}else t.fillStyle=\"black\",t.beginPath(),t.moveTo(-this._hitrad,0),t.lineTo(0,-this._hitrad),t.lineTo(this._hitrad,0),t.strokeRect(-this._hitrad/2,-this._hitrad/2,this._hitrad,this._hitrad),t.stroke();t.restore()}},O=class{constructor(t){this._startticks=h.tick||0,this._sequence=t||[],this.isDone=!1}tick(){this._elapsedticks=h.tick-this._startticks,this._sequence=this._sequence.filter(t=>!(this._elapsedticks>t.endtick)),this._sequence&&0!=this._sequence.length?this._sequence.map(t=>{this._elapsedticks>t.starttick&&(t&&t.action&&!t.executed&&(t.action(),t.executed=!0),t&&t.tickInterval&&t.onTick&&this._elapsedticks%t.tickInterval==0&&t.onTick())}):this.isDone=!0}};window.coot=function(t,e){Math.round(Math.random()*e)==e&&console.log(t)},(new class{constructor(){this._cc=I,this._canvas=this._cc.canvas,this._ctx=this._cc.ctx,this._ui=w,this._restartBs=document.getElementsByClassName(\"b-restart\");for(let t=0;t<this._restartBs.length;t++)this._restartBs[t].addEventListener(\"click\",t=>this._restart());this.spawnPoints=[],this._score=0,this._backAlpha=.2,this.activeSequences=[],this._introSeq=!1,this._state=\"INTRODUCTION\",this._level=0,this._levels=o,h._level=0,h._levels=o,h.player=new B({buildIn:!0,hitrad:15,maxrad:15}),h.entities.push(h.player),this._backPos={x:25,y:20},this._remaining=h.entities,this._prevtime=Date.now(),this._framerate=10}_restart(){h._entities=[],this._level=0,this._state=\"START_LEVEL\",h.player.reset(),this._ui.setState(this._state),this.stateLoop()}_startLevel(t){h.entities=[],h._level=t;let e=this._levels[t];h.player.reset(),h.entities.push(player),Object.keys(e.enemies).map(t=>{let s=e.enemies[t];for(let e=0;e<s;e++)setTimeout(e=>h.entities.push(new A({pos:{x:h.ran(h.bounds.width),y:h.ran(h.bounds.height),angle:0},type:t,buildIn:!0})),150*e)})}stateLoop(){if(Date.now()-this._prevtime>this._framerate){switch(this._prevtime=Date.now(),this._ui.setState(this._state),this._state){case\"INTRODUCTION\":this._introSeq?this._introSeq&&(this._introSeq.tick(),this._introSeq.isDone&&(h.player.setType(\"cPointer\"),this._state=\"START_LEVEL\")):this._introSeq=new O(S.introduction),this._play();break;case\"START_CHOOSE_UPGRADES\":this._ui.showUpgrades({level:this._level,click1:t=>{h.player.setType(h.player.subTypes[2*this._level-1]),this._state=\"START_LEVEL\"},click2:t=>{h.player.setType(h.player.subTypes[2*this._level]),this._state=\"START_LEVEL\"}}),this._state=\"WAIT_CHOOSE_UPGRADES\";break;case\"WAIT_CHOOSE_UPGRADES\":this._play();break;case\"START_LEVEL\":this._backAlpha=.2,this._startLevel(this._level),this._state=\"PLAYING\";break;case\"LEVEL_CLEAR\":console.log(this._level,this._levels.length),this._level+1<this._levels.length?(this._level++,this._state=\"WAIT_CHOOSE_BACK\",h.entities.push(new C({pos:this._backPos}))):this._state=\"START_WIN\";break;case\"WAIT_CHOOSE_BACK\":h.player.collides(this._backPos,50)&&(h.entities.push(new C({pos:this._backPos,fill:\"#111\",maxrad:1e5,buildSpeed:5})),this._state=\"START_CHOOSE_UPGRADES\"),this._play(),this._cc.drawBackButton(1,h.tick);break;case\"START_WIN\":this._ui.setFinalScore(this._score),this._state=\"WAIT_WIN\";break;case\"WAIT_WIN\":this._play();break;case\"DEAD\":this._deathSequence?this._deathSequence&&this._deathSequence.tick():(this._deathSequence=new O(S.dead),this._ui.setFinalScore(this._score)),this._play();break;case\"PLAYING\":this._score++,h.player.isDead&&(this._state=\"DEAD\"),0===h.entities.filter(t=>t._type===n).length&&(this._state=\"LEVEL_CLEAR\"),this._play();break;default:this._play()}h.tick++,this._ui.setScore(this._score)}requestAnimationFrame(t=>this.stateLoop())}_play(){this._cc.ctx.beginPath(),this._cc.clear(),this._cc.drawBackground(),h.player._target=this._cc.cursor,h.entities=h.entities.sort((t,e)=>t._type-e._type),this._remaining=[];for(let t=0;t<h.entities.length;t++){let e=h.entities[t];e.isDead||(e.update(this._ctx),this._remaining.push(e))}h.entities=this._remaining}}).stateLoop();s(7)}]);","extractedComments":[]}